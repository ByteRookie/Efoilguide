  :root{
    color-scheme: light dark;
    --radius:12px; --hover:rgba(0,0,0,.04);
    --bg:#ffffff; --card:#f5f7fa; --muted:#556270; --text:#111; --accent:#0047ab;
    --salt:#4aa6ff; --fresh:#41e36e; --brack:#b07bff;
    --yr:#ffb020; --sprfall:#2fd277; --summer:#ffd24d; --winter:#7dd3fc;
    --easy:#70e000; --med:#ffd166; --hard:#ff6b6b;
    --badge:#e9ecf2; --chip:#e7ecf3; --ok:#006d2c; --warn:#8d7409; --no:#c74f4f;
    --badge-border:#d0d7e2; --chip-border:#cfd6e1; --control-border:#d0d7e2; --table-border:#d0d7e2;
    --input-bg:#ffffff; --input-border:#d0d7e2; --btn-bg:#e0e4ea; --btn-border:#cfd6e1;
    --btn-alt-bg:#d0e9f1; --btn-alt-border:#bcd3db; --toggle-off:#cfd6e1;
    --header-grad1:rgba(255,255,255,.9); --header-grad2:rgba(255,255,255,.6);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0e1116; --card:#151a22; --muted:#8892a6; --text:#e6eefc; --accent:#5ae0ff;
      --badge:#1d2430; --chip:#202735; --badge-border:#2a3346; --chip-border:#263044;
      --control-border:#1f2632; --table-border:#1f2632;
      --input-bg:#0f141c; --input-border:#243046;
      --btn-bg:#233044; --btn-border:#2f3c52;
      --btn-alt-bg:#234a5a; --btn-alt-border:#2f667a;
      --toggle-off:#263044;
      --header-grad1:rgba(14,17,22,.9); --header-grad2:rgba(14,17,22,.6);
      --ok:#2fd277; --warn:#ffad42; --no:#ff6b6b;
      --hover:rgba(255,255,255,.06);
    }
  }
  html,body{background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Inter,Roboto,Arial,sans-serif;font-size:clamp(16px,1.5vw,18px);line-height:1.6;margin:0}
  a{color:var(--accent);text-decoration:none} a:hover{opacity:.9}
  header{position:sticky;top:0;background:linear-gradient(180deg,var(--header-grad1),var(--header-grad2));backdrop-filter:saturate(1.2) blur(8px);z-index:50}
  .wrap{max-width:1200px;margin:auto;padding:clamp(16px,4vw,32px)}
  header .wrap{padding-top:8px}
  main.wrap{padding-top:0}
  h1{margin:8px 0 4px;font-weight:800;font-size:clamp(24px,4vw,40px)}
  .sub{color:var(--muted);font-size:14px}
  details{margin:8px 0}
  details summary{cursor:pointer;color:var(--accent);font-weight:600;list-style:none;font-size:16px}
  details[open] summary{margin-bottom:8px}
  .controls{display:flex;flex-direction:column;gap:12px}
  .control{background:var(--card);border-radius:var(--radius);padding:12px;border:1px solid var(--control-border);box-shadow:0 1px 2px rgba(0,0,0,.05)}
  .control label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:999px;background:var(--chip);font-size:13px;margin:2px 6px 2px 0;border:1px solid var(--chip-border);cursor:pointer;user-select:none}
.chip.active{background:var(--btn-alt-bg);border-color:var(--accent);color:var(--text)}
.chip.b-salt.active{border-left:4px solid var(--salt)}
.chip.b-fresh.active{border-left:4px solid var(--fresh)}
.chip.b-brack.active{border-left:4px solid var(--brack)}
.chip.b-lvle.active{border-left:4px solid var(--easy)}
.chip.b-lvlm.active{border-left:4px solid var(--med)}
.chip.b-lvlh.active{border-left:4px solid var(--hard)}
  .chip-group{display:flex;align-items:center;gap:6px}
.chip-group-label{color:var(--muted);font-size:13px;margin-right:6px;white-space:nowrap}
  .legend-row{display:flex;gap:16px;overflow-x:auto;padding-bottom:4px}
  .legend-row::-webkit-scrollbar{height:6px}
  .legend-row::-webkit-scrollbar-thumb{background:var(--control-border);border-radius:3px}
  .chip.b-yr{border-left:4px solid var(--yr)}
  .chip.b-sprfall{border-left:4px solid var(--sprfall)}
  .chip.b-sum{border-left:4px solid var(--summer)}
  .chip.b-win{border-left:4px solid var(--winter)}
  .toggle{appearance:none;width:42px;height:24px;border-radius:999px;background:var(--toggle-off);position:relative;outline:none;cursor:pointer;vertical-align:middle}
  .toggle:checked{background:var(--accent)}
  .toggle:before{content:'';position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:transform .2s}
  .toggle:checked:before{transform:translateX(18px)}
  .table-wrap{border:1px solid var(--table-border);border-radius:var(--radius);overflow-x:auto;-webkit-overflow-scrolling:touch;width:100%}
  .table-wrap table{width:100%;min-width:600px;border-collapse:separate;border-spacing:0;background:var(--card)}
  .table-wrap thead,.table-wrap tbody tr{display:table;width:100%;table-layout:fixed}
  .table-wrap tbody{display:block;transition:max-height .6s}
  .table-wrap.scroll tbody{overflow:auto;overscroll-behavior:contain}
  .table-wrap thead th{position:sticky;top:var(--header-h);z-index:2;background:var(--card);white-space:nowrap}
    th,td{padding:12px 14px;border-bottom:1px solid var(--table-border);vertical-align:top;font-size:14px;word-break:break-word;text-align:left}
    tbody tr{transition:background .2s}
    tbody tr.hide{display:none}
    tbody tr.parent{cursor:pointer}
    tbody tr.detail-row{background:var(--card)}
    tbody tr:hover{background:var(--hover)}
  th.sortable{cursor:pointer}
  #sortArrow{margin-left:4px}
  .spot{font-weight:700}
  .badge{display:inline-flex;padding:2px 8px;border-radius:999px;background:var(--badge);font-size:12px;border:1px solid var(--badge-border)}
  .b-salt{border-left:4px solid var(--salt)}
  .b-fresh{border-left:4px solid var(--fresh)}
  .b-brack{border-left:4px solid var(--brack)}
  .b-yr{border-left:4px solid var(--yr)}
  .b-sprfall{border-left:4px solid var(--sprfall)}
  .b-sum{border-left:4px solid var(--summer)}
  .b-win{border-left:4px solid var(--winter)}
  .b-lvle{border-left:4px solid var(--easy)}
  .b-lvlm{border-left:4px solid var(--med)}
  .b-lvlh{border-left:4px solid var(--hard)}
  .lvl{display:inline-flex;gap:4px}
  .lvl .dot{width:8px;height:8px;border-radius:50%}
  .lvle{background:var(--easy)} .lvlm{background:var(--med)} .lvlh{background:var(--hard)}
  .pop{white-space:normal}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .no{color:var(--no)}
    .foot{color:var(--muted);font-size:12px;margin-top:8px}
  section{scroll-margin-top:var(--header-h)}
  .card{background:var(--card);border:1px solid var(--control-border);border-radius:var(--radius);padding:16px;margin:16px 0}
  .law{font-size:13px;color:var(--accent)}
  .amen{color:var(--accent)}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .muted{color:var(--muted)}
    .pill{display:inline-block;background:var(--control-border);border:1px solid var(--badge-border);color:var(--text);padding:2px 8px;border-radius:999px;margin-right:6px;font-size:12px}
    .hint{font-size:12px;color:var(--muted)}
    td.detail{padding:16px;font-size:14px}
    td.detail p{margin:6px 0}
    .detail-grid{display:flex;flex-wrap:wrap;gap:16px}
    .detail-grid .img-box{flex:1 1 250px;max-width:300px}
    .detail-grid .img-box img{width:100%;height:auto;border-radius:8px;display:block}
    .detail-grid .img-box .mini-map{width:100%;height:300px;border-radius:8px;overflow:hidden}
    .detail-grid .img-box .img-credit{font-size:12px;color:var(--muted);margin-top:4px}
    .detail-grid .img-box .slide{display:none}
    .detail-grid .img-box .slide.active{display:block}
    .detail-grid .img-box .img-carousel{position:relative}
    .detail-grid .img-box .img-carousel button{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.5);color:#fff;border:none;padding:4px 8px;border-radius:4px;cursor:pointer}
    .detail-grid .img-box .img-carousel button.prev{left:4px}
    .detail-grid .img-box .img-carousel button.next{right:4px}
    .detail-grid .img-box .media-toggle{display:flex;gap:8px;margin-bottom:8px}
    .detail-grid .img-box .media-toggle button{flex:1;background:var(--btn-bg);border:1px solid var(--btn-border);color:var(--text);border-radius:4px;cursor:pointer;padding:4px}
    .detail-grid .img-box .media-toggle button.active{background:var(--btn-alt-bg);border-color:var(--accent)}
    .detail-grid .info{flex:2 1 260px}
    #toTop{position:fixed;right:20px;bottom:20px;padding:10px 12px;border-radius:50%;border:none;background:var(--btn-bg);color:var(--text);box-shadow:0 2px 4px rgba(0,0,0,.2);cursor:pointer;display:none;z-index:100}
  #toTop.show{display:block}
@media (max-width:800px){
    #selectedDetail tbody tr{display:block;margin-bottom:12px}
    #selectedDetail tbody td{display:flex;justify-content:space-between;border-bottom:1px dashed var(--table-border);padding:8px 12px}
    #selectedDetail tbody td:before{content:attr(data-label);color:var(--muted);margin-right:10px}
    #selectedDetail tbody td.detail{display:block}
  }

  @media (max-width:500px){
    .badge{font-size:11px;padding:2px 6px}
    #selectedTop td{font-size:13px}
  }
.cite-group{display:inline-block;margin-left:4px;font-size:0.75em;}
.cite-group a{display:block;color:var(--muted);background:var(--badge);border:1px solid var(--badge-border);border-radius:4px;padding:0 4px;text-decoration:none;}

  #originInfo a,#locationBox{margin-left:8px}
  #locationBox{display:inline-flex;align-items:center;gap:8px}
  #closeLocation{background:none;border:none;font-size:16px;cursor:pointer;color:var(--muted);margin-left:4px;padding:4px}

  .leaflet-popup-content-wrapper,
  .leaflet-popup-tip{background:var(--card);color:var(--text);border:1px solid var(--control-border)}
.leaflet-popup-content{margin:8px 12px;max-width:260px}

  .popup-info{max-width:260px}
  .popup-info h3{margin:0 0 4px;font-size:16px}
  .popup-table{border-collapse:collapse;font-size:13px;width:100%;table-layout:fixed}
  .popup-table th{padding:2px 6px;text-align:right;vertical-align:top;white-space:nowrap;font-weight:600;width:1px}
.popup-table td{padding:2px 6px;word-break:break-word;overflow-wrap:anywhere}

.leaflet-marker-icon.selected{filter:hue-rotate(120deg) brightness(1.3);}

#mapView{display:flex;flex-direction:column;}
#map{flex:1;}
#selectedWrap{display:flex;flex-direction:column;flex:1;border:1px solid var(--table-border);border-radius:var(--radius);overflow:hidden;}
#selectedTop{background:var(--card);overflow-x:auto;-webkit-overflow-scrolling:touch;border-bottom:1px solid var(--table-border);}
#selectedTop table{border-collapse:separate;border-spacing:0;display:flex;width:fit-content;}
#selectedTop tbody{display:flex;}
#selectedTop tr{display:flex;gap:16px;}
#selectedTop td{padding:8px 12px;display:flex;align-items:center;gap:4px;white-space:nowrap;flex:0 0 auto;}
#selectedTop .cell-label{font-weight:600;margin-right:4px;color:var(--muted);}
#selectedDetail{flex:1;overflow:auto;overscroll-behavior:contain;}
#selectedDetail table{width:100%;min-width:0;border-collapse:separate;border-spacing:0;background:var(--card);}
